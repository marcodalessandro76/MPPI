
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Tutorial for the Dataset module &#8212; mppi 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  
   

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">mppi 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
        <a href="
    ../../index.html" class="text-logo">MPPI</a>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../../pwIn.html">PwIn module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../yamboIn.html">YamboIn module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../qeCalc.html">QeCalculator module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../yamboCalc.html">YamboCalculator module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../yamboParser.html">YamboParser module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../datasets.html">Datasets module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">MPPI Tutorials</a></li>
</ul>

    
  </div>
</div>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../../index.html">Docs</a></li>
              
              <li>Tutorial for the Dataset module</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="k">import</span> <span class="n">reload</span>
<span class="kn">from</span> <span class="nn">mppi</span> <span class="k">import</span> <span class="n">InputFiles</span> <span class="k">as</span> <span class="n">I</span><span class="p">,</span> <span class="n">Calculators</span> <span class="k">as</span> <span class="n">C</span><span class="p">,</span> <span class="n">Datasets</span> <span class="k">as</span> <span class="n">D</span>
</pre></div>
</div>
</div>
<div class="section" id="Tutorial-for-the-Dataset-module">
<h1>Tutorial for the Dataset module<a class="headerlink" href="#Tutorial-for-the-Dataset-module" title="Permalink to this headline">¶</a></h1>
<p>The main object to deal with (one or several) calculations is the Dataset class. Here we discuss some explicit examples to describe the usage and the main features of the package.</p>
<div class="section" id="Perform-a-convergence-analysis-for-the-gs-energy-of-Silicon">
<h2>Perform a convergence analysis for the gs energy of Silicon<a class="headerlink" href="#Perform-a-convergence-analysis-for-the-gs-energy-of-Silicon" title="Permalink to this headline">¶</a></h2>
<p>We discuss how to perform a convergence analysis for the determination of the number of k-points and the cut-off energy that provides <em>converged</em> results for the gs of Silicon using QE.</p>
<p>Define the dataset and specify the type of pre_processing function</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">si_gs</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Si gs convergence&#39;</span><span class="p">,</span><span class="n">run_dir</span><span class="o">=</span><span class="s1">&#39;si_gs&#39;</span><span class="p">,</span><span class="n">pre_processing</span><span class="o">=</span><span class="s1">&#39;scf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Define the calculator that will execute the computations</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">code</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">QeCalculator</span><span class="p">(</span><span class="n">omp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mpi_run</span><span class="o">=</span><span class="s1">&#39;mpirun -np 4&#39;</span><span class="p">,</span><span class="n">executable</span><span class="o">=</span><span class="s1">&#39;pw.x&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">skip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Initialize a qe calculator with command OMP_NUM_THREADS=1 mpirun -np 4 pw.x
</pre></div></div>
</div>
<p>Call the pre_processing function, that in this case build the run_dir if it is not already present</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">si_gs</span><span class="o">.</span><span class="n">pre_processing_function</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Append the runs to the dataset. This procedures make usage of the PwIn boject that creates the instance of the input for QE. The object are written on file only at the level of the run</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">si_input</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">PwIn</span><span class="p">()</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.125</span><span class="p">,</span><span class="mf">0.125</span><span class="p">,</span><span class="mf">0.125</span><span class="p">]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[</span><span class="o">-.</span><span class="mi">125</span><span class="p">,</span><span class="o">-.</span><span class="mi">125</span><span class="p">,</span><span class="o">-.</span><span class="mi">125</span><span class="p">]</span>

<span class="n">si_input</span><span class="o">.</span><span class="n">set_pseudo_dir</span><span class="p">(</span><span class="s1">&#39;../pseudos&#39;</span><span class="p">)</span>
<span class="n">si_input</span><span class="o">.</span><span class="n">set_calculation</span><span class="p">(</span><span class="s1">&#39;scf&#39;</span><span class="p">)</span>
<span class="n">si_input</span><span class="o">.</span><span class="n">system</span><span class="p">[</span><span class="s1">&#39;force_symmorphic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;.true.&quot;</span>

<span class="n">si_input</span><span class="o">.</span><span class="n">set_occupations</span><span class="p">(</span><span class="s1">&#39;fixed&#39;</span><span class="p">)</span>
<span class="n">si_input</span><span class="o">.</span><span class="n">system</span><span class="p">[</span><span class="s1">&#39;ibrav&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">si_input</span><span class="o">.</span><span class="n">system</span><span class="p">[</span><span class="s1">&#39;celldm(1)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.3</span>
<span class="n">si_input</span><span class="o">.</span><span class="n">set_atoms_type</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">si_input</span><span class="o">.</span><span class="n">set_atoms_number</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">si_input</span><span class="o">.</span><span class="n">set_atoms_position</span><span class="p">(</span><span class="n">pos_type</span><span class="o">=</span><span class="s1">&#39;crystal&#39;</span><span class="p">,</span><span class="n">pos_list</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Si&#39;</span><span class="p">,</span><span class="n">A</span><span class="p">],[</span><span class="s1">&#39;Si&#39;</span><span class="p">,</span><span class="n">B</span><span class="p">]])</span>
<span class="n">si_input</span><span class="o">.</span><span class="n">atypes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Si&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">28.086</span><span class="p">,</span><span class="s2">&quot;Si.pbe-mt_fhi.UPF&quot;</span><span class="p">]}</span>
<span class="n">si_input</span><span class="o">.</span><span class="n">set_convergence_thr</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">si_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&amp;control
           verbosity = &#39;high&#39;
          pseudo_dir = &#39;../pseudos&#39;
         calculation = &#39;scf&#39;
/&amp;end
&amp;system
    force_symmorphic = .true.
         occupations = &#39;fixed&#39;
               ibrav = 2
           celldm(1) = 10.3
                ntyp = 1
                 nat = 2
/&amp;end
&amp;electrons
            conv_thr = 1e-08
/&amp;end
ATOMIC_SPECIES
  Si   28.086    Si.pbe-mt_fhi.UPF
ATOMIC_POSITIONS { crystal }
 Si   0.1250000000   0.1250000000   0.1250000000
 Si  -0.1250000000  -0.1250000000  -0.1250000000
K_POINTS { automatic }
  1  1  1  0  0  0

</pre></div></div>
</div>
<p>Choose the parameters for the convergence test and append the associated runs</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">kpoints</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">ecut</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kpoints</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ecut</span><span class="p">:</span>
        <span class="n">idd</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;k&#39;</span> <span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;ecut&#39;</span> <span class="p">:</span> <span class="n">e</span><span class="p">}</span>
        <span class="n">si_input</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">name_from_id</span><span class="p">(</span><span class="n">idd</span><span class="p">))</span>
        <span class="n">si_input</span><span class="o">.</span><span class="n">set_kpoints</span><span class="p">(</span><span class="n">ktype</span><span class="o">=</span><span class="s1">&#39;automatic&#39;</span><span class="p">,</span><span class="n">kpoints</span><span class="o">=</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">])</span>
        <span class="n">si_input</span><span class="o">.</span><span class="n">set_energy_cutoff</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">si_gs</span><span class="o">.</span><span class="n">append_run</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">idd</span><span class="p">,</span><span class="n">calculator</span><span class="o">=</span><span class="n">code</span><span class="p">,</span><span class="nb">input</span><span class="o">=</span><span class="n">si_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">si_gs</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&amp;control
           verbosity = &#39;high&#39;
          pseudo_dir = &#39;../pseudos&#39;
         calculation = &#39;scf&#39;
              prefix = &#39;ecut:10,k:3&#39;
/&amp;end
&amp;system
    force_symmorphic = .true.
         occupations = &#39;fixed&#39;
               ibrav = 2
           celldm(1) = 10.3
                ntyp = 1
                 nat = 2
             ecutwfc = 10
/&amp;end
&amp;electrons
            conv_thr = 1e-08
/&amp;end
ATOMIC_SPECIES
  Si   28.086    Si.pbe-mt_fhi.UPF
ATOMIC_POSITIONS { crystal }
 Si   0.1250000000   0.1250000000   0.1250000000
 Si  -0.1250000000  -0.1250000000  -0.1250000000
K_POINTS { automatic }
  3  3  3  0  0  0

</pre></div></div>
</div>
<p>Note tha the prefix associated to each run is built by means of the name_from_id method that create a string from the idd dictionary of the run. This choice is not mandatory but it is an easy way to have a clear association among the runs and the associated names.</p>
<p>The dataset is run as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">si_gs</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">post_processing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
skip the computation for : ecut:10,k:2.log
parse file :si_gs/ecut:10,k:2.save/data-file-schema.xml
skip the computation for : ecut:20,k:2.log
parse file :si_gs/ecut:20,k:2.save/data-file-schema.xml
skip the computation for : ecut:30,k:2.log
parse file :si_gs/ecut:30,k:2.save/data-file-schema.xml
skip the computation for : ecut:40,k:2.log
parse file :si_gs/ecut:40,k:2.save/data-file-schema.xml
skip the computation for : ecut:50,k:2.log
parse file :si_gs/ecut:50,k:2.save/data-file-schema.xml
skip the computation for : ecut:10,k:3.log
parse file :si_gs/ecut:10,k:3.save/data-file-schema.xml
skip the computation for : ecut:20,k:3.log
parse file :si_gs/ecut:20,k:3.save/data-file-schema.xml
skip the computation for : ecut:30,k:3.log
parse file :si_gs/ecut:30,k:3.save/data-file-schema.xml
skip the computation for : ecut:40,k:3.log
parse file :si_gs/ecut:40,k:3.save/data-file-schema.xml
skip the computation for : ecut:50,k:3.log
parse file :si_gs/ecut:50,k:3.save/data-file-schema.xml
skip the computation for : ecut:10,k:4.log
parse file :si_gs/ecut:10,k:4.save/data-file-schema.xml
skip the computation for : ecut:20,k:4.log
parse file :si_gs/ecut:20,k:4.save/data-file-schema.xml
skip the computation for : ecut:30,k:4.log
parse file :si_gs/ecut:30,k:4.save/data-file-schema.xml
skip the computation for : ecut:40,k:4.log
parse file :si_gs/ecut:40,k:4.save/data-file-schema.xml
skip the computation for : ecut:50,k:4.log
parse file :si_gs/ecut:50,k:4.save/data-file-schema.xml
skip the computation for : ecut:10,k:5.log
parse file :si_gs/ecut:10,k:5.save/data-file-schema.xml
skip the computation for : ecut:20,k:5.log
parse file :si_gs/ecut:20,k:5.save/data-file-schema.xml
skip the computation for : ecut:30,k:5.log
parse file :si_gs/ecut:30,k:5.save/data-file-schema.xml
skip the computation for : ecut:40,k:5.log
parse file :si_gs/ecut:40,k:5.save/data-file-schema.xml
skip the computation for : ecut:50,k:5.log
parse file :si_gs/ecut:50,k:5.save/data-file-schema.xml
skip the computation for : ecut:10,k:6.log
parse file :si_gs/ecut:10,k:6.save/data-file-schema.xml
skip the computation for : ecut:20,k:6.log
parse file :si_gs/ecut:20,k:6.save/data-file-schema.xml
skip the computation for : ecut:30,k:6.log
parse file :si_gs/ecut:30,k:6.save/data-file-schema.xml
skip the computation for : ecut:40,k:6.log
parse file :si_gs/ecut:40,k:6.save/data-file-schema.xml
skip the computation for : ecut:50,k:6.log
parse file :si_gs/ecut:50,k:6.save/data-file-schema.xml
</pre></div></div>
</div>
<p>Results can be easily estracted using the fetch_results method of the dataset</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kpoints</span><span class="p">:</span>
    <span class="n">data</span><span class="o">=</span><span class="n">si_gs</span><span class="o">.</span><span class="n">fetch_results</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">},</span><span class="n">attribute</span><span class="o">=</span><span class="s1">&#39;E_tot&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecut</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;k=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">si_gs</span><span class="o">.</span><span class="n">label</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;cut off energy (Ry)&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;GS energy (Ha)&#39;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_.ipynb_checkpoints_Tutorial-Datasets-checkpoint_19_0.png" src="../../_images/tutorials_.ipynb_checkpoints_Tutorial-Datasets-checkpoint_19_0.png" />
</div>
</div>
<p>On the basis of this analysis with identify the scf converged parameters that will be used as input for nscf ones</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">k_conv</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">ecut_conv</span> <span class="o">=</span> <span class="mi">50</span>
</pre></div>
</div>
</div>
<p>All the results are written in the .results member of the dataset. This is a dictionary in wich all the post_processing are stored, the key represent the position of the study specified in the .ids list</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">si_gs</span><span class="o">.</span><span class="n">results</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>{0: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f229eff98&gt;,
 1: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f224556a0&gt;,
 2: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f223def28&gt;,
 3: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f223c8fd0&gt;,
 4: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f223dee80&gt;,
 5: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f223e9e48&gt;,
 6: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f22455828&gt;,
 7: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f224557f0&gt;,
 8: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f22375a90&gt;,
 9: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f223bbda0&gt;,
 10: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f22382898&gt;,
 11: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f22396400&gt;,
 12: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f223de978&gt;,
 13: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f223b1358&gt;,
 14: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f2233bf28&gt;,
 15: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f22353cc0&gt;,
 16: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f223e9208&gt;,
 17: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f2245dda0&gt;,
 18: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f222fda20&gt;,
 19: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f22382c18&gt;,
 20: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f223bbbe0&gt;,
 21: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f222f0518&gt;,
 22: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f223debe0&gt;,
 23: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f22375fd0&gt;,
 24: &lt;qepppy.qe.pw_out.pw_out at 0x7f0f223ae7b8&gt;}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">si_gs</span><span class="o">.</span><span class="n">ids</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[{&#39;k&#39;: 2, &#39;ecut&#39;: 10},
 {&#39;k&#39;: 2, &#39;ecut&#39;: 20},
 {&#39;k&#39;: 2, &#39;ecut&#39;: 30},
 {&#39;k&#39;: 2, &#39;ecut&#39;: 40},
 {&#39;k&#39;: 2, &#39;ecut&#39;: 50},
 {&#39;k&#39;: 3, &#39;ecut&#39;: 10},
 {&#39;k&#39;: 3, &#39;ecut&#39;: 20},
 {&#39;k&#39;: 3, &#39;ecut&#39;: 30},
 {&#39;k&#39;: 3, &#39;ecut&#39;: 40},
 {&#39;k&#39;: 3, &#39;ecut&#39;: 50},
 {&#39;k&#39;: 4, &#39;ecut&#39;: 10},
 {&#39;k&#39;: 4, &#39;ecut&#39;: 20},
 {&#39;k&#39;: 4, &#39;ecut&#39;: 30},
 {&#39;k&#39;: 4, &#39;ecut&#39;: 40},
 {&#39;k&#39;: 4, &#39;ecut&#39;: 50},
 {&#39;k&#39;: 5, &#39;ecut&#39;: 10},
 {&#39;k&#39;: 5, &#39;ecut&#39;: 20},
 {&#39;k&#39;: 5, &#39;ecut&#39;: 30},
 {&#39;k&#39;: 5, &#39;ecut&#39;: 40},
 {&#39;k&#39;: 5, &#39;ecut&#39;: 50},
 {&#39;k&#39;: 6, &#39;ecut&#39;: 10},
 {&#39;k&#39;: 6, &#39;ecut&#39;: 20},
 {&#39;k&#39;: 6, &#39;ecut&#39;: 30},
 {&#39;k&#39;: 6, &#39;ecut&#39;: 40},
 {&#39;k&#39;: 6, &#39;ecut&#39;: 50}]
</pre></div>
</div>
</div>
<p>A lot of quantities can be extracted from results, for instance</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">result</span> <span class="o">=</span> <span class="n">si_gs</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">result</span><span class="o">.</span><span class="n">E_tot</span> <span class="c1">#total energy in Hartree</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>-7.761788836295096
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">result</span><span class="o">.</span><span class="n">alat</span> <span class="c1">#atomic units = angstrom/0.529177211</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>10.3
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">result</span><span class="o">.</span><span class="n">atoms_coord_cart</span> <span class="c1"># in which units ?????</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>array([[-1.2875,  1.2875,  1.2875],
       [ 1.2875, -1.2875, -1.2875]])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1">#pFile : option to enable/disable file save</span>
<span class="c1">#fname : output file name</span>
<span class="n">result</span><span class="o">.</span><span class="n">density_of_states</span><span class="p">(</span><span class="n">pFile</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
No handles with labels found to put in legend.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_.ipynb_checkpoints_Tutorial-Datasets-checkpoint_30_1.png" src="../../_images/tutorials_.ipynb_checkpoints_Tutorial-Datasets-checkpoint_30_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>array([[-20.   ,   0.   ],
       [-19.999,   0.   ],
       [-19.998,   0.   ],
       ...,
       [ 19.998,   0.   ],
       [ 19.999,   0.   ],
       [ 20.   ,   0.   ]])
</pre></div>
</div>
</div>
</div>
<div class="section" id="Perform-a-sef-of-nscf-computations-for-Silicon">
<h2>Perform a sef of nscf computations for Silicon<a class="headerlink" href="#Perform-a-sef-of-nscf-computations-for-Silicon" title="Permalink to this headline">¶</a></h2>
<p>We illustrate the usage of the dataset class to perform nscf computations using QE. In this case the pre_processing function performs different operations since the .save folder of the scf computation used as input has to be copied in the run_dir of the nscf dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">si_nscf</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Si nscf&#39;</span><span class="p">,</span><span class="n">run_dir</span><span class="o">=</span><span class="s1">&#39;si_nscf&#39;</span><span class="p">,</span><span class="n">pre_processing</span><span class="o">=</span><span class="s1">&#39;nscf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Define the calculator that will execute the computations</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">code</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">QeCalculator</span><span class="p">(</span><span class="n">omp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mpi_run</span><span class="o">=</span><span class="s1">&#39;mpirun -np 4&#39;</span><span class="p">,</span><span class="n">executable</span><span class="o">=</span><span class="s1">&#39;pw.x&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">skip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Initialize a qe calculator with command OMP_NUM_THREADS=1 mpirun -np 4 pw.x
</pre></div></div>
</div>
<p>Add some runs to the nscf dataset</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">nscf_kpoints</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">si_input</span><span class="o">.</span><span class="n">set_calculation</span><span class="p">(</span><span class="s1">&#39;nscf&#39;</span><span class="p">)</span>
<span class="n">si_input</span><span class="o">.</span><span class="n">set_num_bands</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nscf_kpoints</span><span class="p">:</span>
    <span class="n">idd</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;k&#39;</span> <span class="p">:</span> <span class="n">k</span><span class="p">}</span>
    <span class="n">si_input</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">name_from_id</span><span class="p">(</span><span class="n">idd</span><span class="p">))</span>
    <span class="n">si_input</span><span class="o">.</span><span class="n">set_kpoints</span><span class="p">(</span><span class="n">ktype</span><span class="o">=</span><span class="s1">&#39;automatic&#39;</span><span class="p">,</span><span class="n">kpoints</span><span class="o">=</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">])</span>
    <span class="n">si_input</span><span class="o">.</span><span class="n">set_energy_cutoff</span><span class="p">(</span><span class="n">ecut_conv</span><span class="p">)</span>
    <span class="n">si_nscf</span><span class="o">.</span><span class="n">append_run</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">idd</span><span class="p">,</span><span class="n">calculator</span><span class="o">=</span><span class="n">code</span><span class="p">,</span><span class="nb">input</span><span class="o">=</span><span class="n">si_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">si_nscf</span><span class="o">.</span><span class="n">ids</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[{&#39;k&#39;: 4}, {&#39;k&#39;: 5}, {&#39;k&#39;: 6}]
</pre></div>
</div>
</div>
<p>Call the pre_processing function, that in this case build the run_dir if it is not already present</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">si_nscf</span><span class="o">.</span><span class="n">pre_processing_function</span><span class="p">(</span><span class="n">source_dir</span><span class="o">=</span><span class="s1">&#39;si_gs/ecut:50,k:4.save&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Create folder si_nscf
execute :  cp -r si_gs/ecut:50,k:4.save si_nscf/k:4.save
execute :  cp -r si_gs/ecut:50,k:4.save si_nscf/k:5.save
execute :  cp -r si_gs/ecut:50,k:4.save si_nscf/k:6.save
</pre></div></div>
</div>
<p>Now the dataset can be run and the post_processing parse the output as in the scf case</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">si_nscf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
execute : cd si_nscf ; OMP_NUM_THREADS=1 mpirun -np 4 pw.x -inp k:4.in &gt; k:4.log
parse file :si_nscf/k:4.save/data-file-schema.xml
execute : cd si_nscf ; OMP_NUM_THREADS=1 mpirun -np 4 pw.x -inp k:5.in &gt; k:5.log
parse file :si_nscf/k:5.save/data-file-schema.xml
execute : cd si_nscf ; OMP_NUM_THREADS=1 mpirun -np 4 pw.x -inp k:6.in &gt; k:6.log
parse file :si_nscf/k:6.save/data-file-schema.xml
</pre></div></div>
</div>
</div>
<div class="section" id="Perform-a-set-of-Hartree-Fock-computations-with-Yambo">
<h2>Perform a set of Hartree-Fock computations with Yambo<a class="headerlink" href="#Perform-a-set-of-Hartree-Fock-computations-with-Yambo" title="Permalink to this headline">¶</a></h2>
<p>Dataset can be used to organize Yambo computation in an analogous way of the QE ones. The differences are represented by the usage of YamboIn to build the input files, the usage of YamboCalculator to run the computations and by the pre_processing function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">code</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">YamboCalculator</span><span class="p">(</span><span class="n">omp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mpi_run</span><span class="o">=</span><span class="s1">&#39;mpirun -np 4&#39;</span><span class="p">,</span><span class="n">executable</span><span class="o">=</span><span class="s1">&#39;yambo&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">skip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Initialize a Yambo calculator with command OMP_NUM_THREADS=1 mpirun -np 4 yambo
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">yambo_hf</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Hatree-Fock&#39;</span><span class="p">,</span><span class="n">run_dir</span><span class="o">=</span><span class="s1">&#39;yambo_hf&#39;</span><span class="p">,</span><span class="n">pre_processing</span><span class="o">=</span><span class="s1">&#39;yambo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In this case the pre_processing function <em>has to be</em> called before appending the runs because the YamboIn class neeeds the SAVE folder to init the input object.</p>
<p>The dataset make usage of <strong>one</strong> nscf computation to build the SAVE folder that is used in all the runs</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;si_nscf/k:6.save&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">yambo_hf</span><span class="o">.</span><span class="n">pre_processing_function</span><span class="p">(</span><span class="n">source_dir</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SAVE folder already present in yambo_hf
</pre></div></div>
</div>
<p>Now the runs can be appended to the dataset. For instance we perform parametric runs in terms of the EXXRLvcs parameter that expresses the energy cutoff in the number of g-components of G0</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">exx_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.</span><span class="p">,</span><span class="mf">3.</span><span class="p">,</span><span class="mf">4.</span><span class="p">]</span> <span class="c1">#in Hartree</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">yambo_in</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">YamboIn</span><span class="p">(</span><span class="s1">&#39;yambo -x -V rl&#39;</span><span class="p">,</span><span class="n">folder</span><span class="o">=</span><span class="n">yambo_hf</span><span class="o">.</span><span class="n">run_dir</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">exx_values</span><span class="p">:</span>
    <span class="n">idd</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;EXXRLvcs&#39;</span> <span class="p">:</span> <span class="n">ex</span><span class="p">}</span>
    <span class="n">yambo_in</span><span class="p">[</span><span class="s1">&#39;EXXRLvcs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1000.0</span><span class="o">*</span><span class="n">ex</span><span class="p">,</span><span class="s1">&#39;mHa&#39;</span><span class="p">]</span>
    <span class="n">yambo_hf</span><span class="o">.</span><span class="n">append_run</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">idd</span><span class="p">,</span><span class="n">calculator</span><span class="o">=</span><span class="n">code</span><span class="p">,</span><span class="nb">input</span><span class="o">=</span><span class="n">yambo_in</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">yambo_hf</span><span class="o">.</span><span class="n">ids</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[{&#39;EXXRLvcs&#39;: 2.0}, {&#39;EXXRLvcs&#39;: 3.0}, {&#39;EXXRLvcs&#39;: 4.0}]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">yambo_hf</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
HF_and_locXC
FFTGvecs = 2133.000000 RL
SE_Threads = 0.000000e+00
EXXRLvcs = 2000.000000 mHa
% QPkrange
 1 | 32 | 1 | 10 |
%

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">yambo_hf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
jobname : EXXRLvcs:2.0
skip the computation for : yambo_hf/EXXRLvcs:2.0/o-EXXRLvcs:2.0.hf
parse file :yambo_hf/EXXRLvcs:2.0/o-EXXRLvcs:2.0.hf
jobname : EXXRLvcs:3.0
skip the computation for : yambo_hf/EXXRLvcs:3.0/o-EXXRLvcs:3.0.hf
parse file :yambo_hf/EXXRLvcs:3.0/o-EXXRLvcs:3.0.hf
jobname : EXXRLvcs:4.0
skip the computation for : yambo_hf/EXXRLvcs:4.0/o-EXXRLvcs:4.0.hf
parse file :yambo_hf/EXXRLvcs:4.0/o-EXXRLvcs:4.0.hf
</pre></div></div>
</div>
<p>Results can be extraced in various ways, both using the fetch_results methods or by direct access to the attribute of the Yambo parser. Here we provide some examples.</p>
<p>First of all we can see the names of the attributes for each elements of yambo_hf.results as follows</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">keys</span> <span class="o">=</span> <span class="n">yambo_hf</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getAttibutes</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;K-point&#39;, &#39;Band&#39;, &#39;Eo&#39;, &#39;Ehf&#39;, &#39;DFT&#39;, &#39;HF&#39;])
</pre></div></div>
</div>
<p>Then, we can access to the values directly as</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">yambo_hf</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Ehf</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[-18.69873, -1.207, -1.438, -0.62819, 6.98599]
</pre></div>
</div>
</div>
<p>Or by using the fetch_results</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">yambo_hf</span><span class="o">.</span><span class="n">fetch_results</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;EXXRLvcs&#39;</span> <span class="p">:</span> <span class="mf">2.0</span><span class="p">},</span><span class="n">attribute</span><span class="o">=</span><span class="s1">&#39;Ehf&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[-18.69873, -1.207, -1.438, -0.62819, 6.98599]
</pre></div>
</div>
</div>
<p>Also we can use fetch_results to extract the computation(s) that we need and then access directly to the attributes</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">yambo_hf</span><span class="o">.</span><span class="n">fetch_results</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;EXXRLvcs&#39;</span> <span class="p">:</span> <span class="mf">2.0</span><span class="p">})[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Ehf</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[-18.69873, -1.207, -1.438, -0.62819, 6.98599]
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
            
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">mppi 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2019, Marco D'Alessandro. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>