
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Usage of Dataset class &#8212; mppi 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  
   

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">mppi 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
        <a href="
    ../../index.html" class="text-logo">MPPI</a>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../../pwIn.html">PwIn module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../yamboIn.html">YamboIn module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../qeCalc.html">QeCalculator module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../yamboCalc.html">YamboCalculator module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../yamboParser.html">YamboParser module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../datasets.html">Datasets module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">MPPI Tutorials</a></li>
</ul>

    
  </div>
</div>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../../index.html">Docs</a></li>
              
              <li>Usage of Dataset class</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Usage-of-Dataset-class">
<h1>Usage of Dataset class<a class="headerlink" href="#Usage-of-Dataset-class" title="Permalink to this headline">Â¶</a></h1>
<p>We here show the API of the Dataset class, conceived to run and collects ensemble calculations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">BigDFT</span> <span class="kn">import</span> <span class="n">Datasets</span> <span class="k">as</span> <span class="n">D</span><span class="p">,</span> <span class="n">Calculators</span> <span class="k">as</span> <span class="n">C</span><span class="p">,</span> <span class="n">Inputfiles</span> <span class="k">as</span> <span class="n">I</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ImportError</span>                               Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-1-e6cbf763d305&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">from</span> BigDFT <span class="ansi-green-fg">import</span> Datasets <span class="ansi-green-fg">as</span> D<span class="ansi-blue-fg">,</span> Calculators <span class="ansi-green-fg">as</span> C<span class="ansi-blue-fg">,</span> Inputfiles <span class="ansi-green-fg">as</span> I
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-green-fg">import</span> numpy <span class="ansi-green-fg">as</span> np
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span class="ansi-green-fg">import</span> matplotlib<span class="ansi-blue-fg">.</span>pyplot <span class="ansi-green-fg">as</span> plt

<span class="ansi-red-fg">ImportError</span>: No module named BigDFT
</pre></div></div>
</div>
<p>As first explanatory example we present the analysis of the convergence of the Ground State (GS) energy of a <span class="math">\(CO\)</span> with respect to the size of the simulation domain</p>
<div class="section" id="Analysis-of-dataset-for-the-convergence-of-the-GS-of-the-CO-molecule">
<h2>Analysis of dataset for the convergence of the GS of the CO molecule<a class="headerlink" href="#Analysis-of-dataset-for-the-convergence-of-the-GS-of-the-CO-molecule" title="Permalink to this headline">Â¶</a></h2>
<p>We instanciate on object of the system calculator class which specifies the number of threads and mpi processor used for the computation, we also instanciate the Dataset object that manage the ensemble of calculation needed for the convergence analysis</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">code</span><span class="o">=</span><span class="n">C</span><span class="o">.</span><span class="n">SystemCalculator</span><span class="p">(</span><span class="n">omp</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">mpi_run</span><span class="o">=</span><span class="s1">&#39;mpirun -np 4&#39;</span><span class="p">,</span><span class="n">skip</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">study</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;CO_GS&#39;</span><span class="p">,</span><span class="n">run_dir</span><span class="o">=</span><span class="s1">&#39;CO_GS&#39;</span><span class="p">,</span><span class="n">posinp</span><span class="o">=</span><span class="s1">&#39;CO_posinp.xyz&#39;</span><span class="p">,</span><span class="n">molecule_shape</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Initialize a Calculator with OMP_NUM_THREADS=2 and command mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft
</pre></div></div>
</div>
<p>study is caractherized by its label âCO_GSâ and contains the path run_dir in which all the calculation of the dataset will be performed and the name of the posinp of the molecule. The variable molecule_shape has been introduced to show how further information can be passed to the dataset instances. This information can be extracted as follows</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="n">study</span><span class="o">.</span><span class="n">global_options</span><span class="p">()</span>
<span class="k">print</span> <span class="n">study</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;molecule_shape&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;molecule_shape&#39;: &#39;linear&#39;, &#39;run_dir&#39;: &#39;CO_GS&#39;, &#39;posinp&#39;: &#39;CO_posinp.xyz&#39;, &#39;label&#39;: &#39;CO_GS&#39;}
linear
</pre></div></div>
</div>
<p>Global options can be also added and removed as follows</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">study</span><span class="o">.</span><span class="n">update_global_options</span><span class="p">(</span><span class="n">new_option</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">study</span><span class="o">.</span><span class="n">global_options</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;molecule_shape&#39;: &#39;linear&#39;, &#39;run_dir&#39;: &#39;CO_GS&#39;, &#39;posinp&#39;: &#39;CO_posinp.xyz&#39;, &#39;new_option&#39;: &#39;value&#39;, &#39;label&#39;: &#39;CO_GS&#39;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># remove the new_option key</span>
<span class="n">study</span><span class="o">.</span><span class="n">pop_global_option</span><span class="p">(</span><span class="s1">&#39;new_option&#39;</span><span class="p">)</span>
<span class="n">study</span><span class="o">.</span><span class="n">global_options</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>{&#39;label&#39;: &#39;CO_GS&#39;,
 &#39;molecule_shape&#39;: &#39;linear&#39;,
 &#39;posinp&#39;: &#39;CO_posinp.xyz&#39;,
 &#39;run_dir&#39;: &#39;CO_GS&#39;}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Define the default parameters of the input file</span>
<span class="n">inp</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">Inputfile</span><span class="p">()</span>
<span class="n">inp</span><span class="o">.</span><span class="n">set_hgrid</span><span class="p">(</span><span class="mf">0.37</span><span class="p">)</span>
<span class="n">inp</span><span class="o">.</span><span class="n">set_wavefunction_convergence</span><span class="p">(</span><span class="n">gnrm</span><span class="o">=</span><span class="mf">1.0e-5</span><span class="p">)</span>
<span class="n">inp</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>{&#39;dft&#39;: {&#39;gnrm_cv&#39;: 1e-05, &#39;hgrids&#39;: 0.37}}
</pre></div>
</div>
</div>
<p>We introduce a list of values of rmult. The convergence analysis will be performed on this parameter</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">rmult</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">6.0</span><span class="p">,</span><span class="mf">7.0</span><span class="p">,</span><span class="mf">8.0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>We prepare the study for the convergence analysis by appending the run associated to the values of rmult. Each run is caractherized by an id and contain the InputFile object as input as well as the code used to perform the calculation. If the same id is provided more than one the function gives a Value Error</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rmult</span><span class="p">:</span>
    <span class="n">inp</span><span class="o">.</span><span class="n">set_rmult</span><span class="p">(</span><span class="n">coarse</span><span class="o">=</span><span class="n">r</span><span class="p">,</span><span class="n">fine</span><span class="o">=</span><span class="mf">9.0</span><span class="p">)</span>
    <span class="n">study</span><span class="o">.</span><span class="n">append_run</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rmult&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">},</span><span class="n">runner</span><span class="o">=</span><span class="n">code</span><span class="p">,</span><span class="nb">input</span><span class="o">=</span><span class="n">inp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The following member of the Dataset class show how to refer to the various calculation of study</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="n">study</span><span class="o">.</span><span class="n">calculators</span>
<span class="k">print</span> <span class="n">study</span><span class="o">.</span><span class="n">ids</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;runs&#39;: [0, 1, 2, 3], &#39;calc&#39;: &lt;BigDFT.Calculators.SystemCalculator instance at 0x7fda93752950&gt;}]
[{&#39;rmult&#39;: 5.0}, {&#39;rmult&#39;: 6.0}, {&#39;rmult&#39;: 7.0}, {&#39;rmult&#39;: 8.0}]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Extract the study id and runs parameters for each value of the runs key in the study.calculator.</span>
<span class="c1"># Shows just one for shortness</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">print</span> <span class="n">study</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="k">print</span> <span class="n">study</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;rmult&#39;: 7.0}
{&#39;molecule_shape&#39;: &#39;linear&#39;, &#39;run_dir&#39;: &#39;CO_GS&#39;, &#39;posinp&#39;: &#39;CO_posinp.xyz&#39;, &#39;input&#39;: {&#39;dft&#39;: {&#39;rmult&#39;: [7.0, 9.0], &#39;hgrids&#39;: 0.37, &#39;gnrm_cv&#39;: 1e-05}}, &#39;label&#39;: &#39;CO_GS&#39;}
</pre></div></div>
</div>
<p>Study.names contains a list of strings with the ids of the run. May be useful for labelling.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">study</span><span class="o">.</span><span class="n">names</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[&#39;rmult:5.0&#39;, &#39;rmult:6.0&#39;, &#39;rmult:7.0&#39;, &#39;rmult:8.0&#39;]
</pre></div>
</div>
</div>
<p>The appended simulation can be executed with the run method. The skip=True in the code instance guarantees that computation already performed are not executed again</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">study</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_GS&#39;
Creating the yaml input file &#34;CO_GS/rmult:5.0.yaml&#34;
Run directory CO_GS
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n rmult:5.0 -s Yes
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_GS&#39;
Creating the yaml input file &#34;CO_GS/rmult:6.0.yaml&#34;
Run directory CO_GS
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n rmult:6.0 -s Yes
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_GS&#39;
Creating the yaml input file &#34;CO_GS/rmult:7.0.yaml&#34;
Run directory CO_GS
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n rmult:7.0 -s Yes
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_GS&#39;
Creating the yaml input file &#34;CO_GS/rmult:8.0.yaml&#34;
Run directory CO_GS
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n rmult:8.0 -s Yes
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>{0: &lt;BigDFT.Logfiles.Logfile instance at 0x7fdac7d69368&gt;,
 1: &lt;BigDFT.Logfiles.Logfile instance at 0x7fda93752cb0&gt;,
 2: &lt;BigDFT.Logfiles.Logfile instance at 0x7fda936bffc8&gt;,
 3: &lt;BigDFT.Logfiles.Logfile instance at 0x7fdac41bfef0&gt;}
</pre></div>
</div>
</div>
<p>The class member study.results contain a dictionary with the logfiles of the computations performed by the run method. The cardinal key respects the order of the append_run</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">results</span>
<span class="n">results</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>{0: &lt;BigDFT.Logfiles.Logfile instance at 0x7fdac7d69368&gt;,
 1: &lt;BigDFT.Logfiles.Logfile instance at 0x7fda93752cb0&gt;,
 2: &lt;BigDFT.Logfiles.Logfile instance at 0x7fda936bffc8&gt;,
 3: &lt;BigDFT.Logfiles.Logfile instance at 0x7fdac41bfef0&gt;}
</pre></div>
</div>
</div>
<p>Several operation can be performed on the results by using the methods of the logfile class. Here we provide some examples</p>
<p>Perform a convergence plot of the total energy w.r.t. the domain size</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">calc</span> <span class="ow">in</span> <span class="n">study</span><span class="o">.</span><span class="n">calculators</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;runs&#39;</span><span class="p">]:</span>
    <span class="k">print</span> <span class="n">study</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">calc</span><span class="p">][</span><span class="s1">&#39;rmult&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="n">calc</span><span class="p">]</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span> <span class="n">study</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">calc</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">calc</span><span class="p">][</span><span class="s1">&#39;rmult&#39;</span><span class="p">],</span><span class="n">results</span><span class="p">[</span><span class="n">calc</span><span class="p">]</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">study</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">calc</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">21.636</span><span class="p">,</span><span class="o">-</span><span class="mf">21.634</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
5.0 -21.634715596 rmult:5.0
6.0 -21.6349449262 rmult:6.0
7.0 -21.6349706091 rmult:7.0
8.0 -21.634970716 rmult:8.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_.ipynb_checkpoints_Datasets-checkpoint_27_1.png" src="../../_images/tutorials_.ipynb_checkpoints_Datasets-checkpoint_27_1.png" />
</div>
</div>
<p>Other useful quantities can be extract using the methods of the logfile class, for instance</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dipole</span>
<span class="k">print</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">evals</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="s1">&#39;dft&#39;</span><span class="p">][</span><span class="s1">&#39;rmult&#39;</span><span class="p">]</span>
<span class="k">print</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="s1">&#39;Electric Dipole Moment (AU)&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[-0.0002716861, -0.0002716861, -0.06843304]
[-1.01570312 -0.52280767 -0.40801067 -0.40801059 -0.3436257 ]
[5.0, 9.0]
{&#39;norm(P)&#39;: 0.0684341231, &#39;P vector&#39;: [-0.0002716861, -0.0002716861, -0.06843304]}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">dos</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_dos</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">study</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">dos</span><span class="o">.</span><span class="n">append_from_bandarray</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">evals</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">study</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">dos</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_.ipynb_checkpoints_Datasets-checkpoint_30_0.png" src="../../_images/tutorials_.ipynb_checkpoints_Datasets-checkpoint_30_0.png" />
</div>
</div>
</div>
<div class="section" id="Post-processing-analysis:-fetch_results-and-post-processing-function">
<h2>Post processing analysis: fetch_results and post-processing function<a class="headerlink" href="#Post-processing-analysis:-fetch_results-and-post-processing-function" title="Permalink to this headline">Â¶</a></h2>
<p>Results associated to specific id and/or attribute can be extracted as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">study</span><span class="o">.</span><span class="n">fetch_results</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[&lt;BigDFT.Logfiles.Logfile instance at 0x7fdac7d69368&gt;,
 &lt;BigDFT.Logfiles.Logfile instance at 0x7fda93752cb0&gt;,
 &lt;BigDFT.Logfiles.Logfile instance at 0x7fda936bffc8&gt;,
 &lt;BigDFT.Logfiles.Logfile instance at 0x7fdac41bfef0&gt;]
</pre></div>
</div>
</div>
<p>If an attribute and/or an id is provided fetch_results extracts only the wanted results, for instance</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span>  <span class="n">study</span><span class="o">.</span><span class="n">fetch_results</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s1">&#39;energy&#39;</span><span class="p">)</span>
<span class="k">print</span>  <span class="n">study</span><span class="o">.</span><span class="n">fetch_results</span><span class="p">({</span><span class="s1">&#39;rmult&#39;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">},</span><span class="n">attribute</span><span class="o">=</span><span class="s1">&#39;energy&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[-21.634715596005396, -21.634944926201616, -21.634970609120057, -21.634970716032644]
[-21.634970716032644]
</pre></div></div>
</div>
<p>It is also possible to define a post-processing function that is passed to the dataset instance. This function is called after the run and the output of study.run() and contains the output of the post-processing function. We show some examples.</p>
<p>Extraction of the ground state dipole</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_dipole</span><span class="p">(</span><span class="n">dataset</span><span class="p">):</span>
    <span class="n">dipole</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">fetch_results</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s1">&#39;dipole&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dipole</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">study</span><span class="o">.</span><span class="n">set_postprocessing_function</span><span class="p">(</span><span class="n">get_dipole</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">dipole_GS</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">dipole_GS</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_GS&#39;
Creating the yaml input file &#34;CO_GS/rmult:5.0.yaml&#34;
Run directory CO_GS
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n rmult:5.0 -s Yes
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_GS&#39;
Creating the yaml input file &#34;CO_GS/rmult:6.0.yaml&#34;
Run directory CO_GS
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n rmult:6.0 -s Yes
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_GS&#39;
Creating the yaml input file &#34;CO_GS/rmult:7.0.yaml&#34;
Run directory CO_GS
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n rmult:7.0 -s Yes
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_GS&#39;
Creating the yaml input file &#34;CO_GS/rmult:8.0.yaml&#34;
Run directory CO_GS
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n rmult:8.0 -s Yes
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[[-0.0002716861, -0.0002716861, -0.06843304],
 [-3.909925e-05, -3.909925e-05, -0.07145626],
 [8.546611e-07, 8.546611e-07, -0.07191747],
 [-1.416639e-05, -1.416639e-05, -0.07195065]]
</pre></div>
</div>
</div>
<p>Extraction of the box size</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="n">study</span><span class="p">):</span> <span class="c1"># how to do def get_size(study,unit)</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">fetch_results</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">calc</span><span class="p">,</span><span class="n">res</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
        <span class="n">sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="s1">&#39;Sizes of the simulation domain&#39;</span><span class="p">][</span><span class="s1">&#39;AU&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">sizes</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">study</span><span class="o">.</span><span class="n">set_postprocessing_function</span><span class="p">(</span><span class="n">get_size</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">boxsize</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">boxsize</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_GS&#39;
Creating the yaml input file &#34;CO_GS/rmult:5.0.yaml&#34;
Run directory CO_GS
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n rmult:5.0 -s Yes
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_GS&#39;
Creating the yaml input file &#34;CO_GS/rmult:6.0.yaml&#34;
Run directory CO_GS
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n rmult:6.0 -s Yes
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_GS&#39;
Creating the yaml input file &#34;CO_GS/rmult:7.0.yaml&#34;
Run directory CO_GS
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n rmult:7.0 -s Yes
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_GS&#39;
Creating the yaml input file &#34;CO_GS/rmult:8.0.yaml&#34;
Run directory CO_GS
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n rmult:8.0 -s Yes
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[[15.54, 15.54, 16.28],
 [18.87, 18.87, 18.87],
 [21.83, 21.83, 21.83],
 [25.16, 25.16, 25.16]]
</pre></div>
</div>
</div>
</div>
<div class="section" id="Usage-of-Dataset-for-the-computation-of-the-statical-polarizability-tensor-">
<h2>Usage of Dataset for the computation of the statical polarizability tensor <span class="math">\(\alpha\)</span><a class="headerlink" href="#Usage-of-Dataset-for-the-computation-of-the-statical-polarizability-tensor-" title="Permalink to this headline">Â¶</a></h2>
<p>We choose a single value of rmult, among the ones computed in the gs analysis, and compute the statical polarizability tensor of the <span class="math">\(CO\)</span> molecule</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">ind</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">print</span> <span class="s1">&#39;rmult value : &#39;</span><span class="p">,</span> <span class="n">study</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;rmult&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
rmult value :  7.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># The ground state dipole can be extracted in several ways from the previous analysis</span>
<span class="k">print</span> <span class="n">dipole_GS</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
<span class="k">print</span> <span class="n">study</span><span class="o">.</span><span class="n">fetch_results</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span><span class="n">attribute</span><span class="o">=</span><span class="s1">&#39;dipole&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[8.546611e-07, 8.546611e-07, -0.07191747]
[[8.546611e-07, 8.546611e-07, -0.07191747]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># set the input file for the statical polarizability computation</span>
<span class="n">inp</span><span class="o">.</span><span class="n">set_rmult</span><span class="p">(</span><span class="n">coarse</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s1">&#39;rmult&#39;</span><span class="p">],</span> <span class="n">fine</span> <span class="o">=</span> <span class="mf">9.0</span><span class="p">)</span>
<span class="n">inp</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>{&#39;dft&#39;: {&#39;gnrm_cv&#39;: 1e-05, &#39;hgrids&#39;: 0.37, &#39;rmult&#39;: [7.0, 9.0]}}
</pre></div>
</div>
</div>
<p>Define the dataset (called ef, i.e. electric field) for the computation of <span class="math">\(\alpha\)</span> and append the relevan runs</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">intensity</span><span class="o">=</span><span class="mf">1.e-2</span> <span class="c1">#assume that this value is compatible with the linear response regime</span>
<span class="n">ef</span><span class="o">=</span><span class="n">D</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="n">run_dir</span><span class="o">=</span><span class="s1">&#39;CO_alpha&#39;</span><span class="p">,</span><span class="nb">input</span><span class="o">=</span><span class="n">inp</span><span class="p">,</span><span class="n">posinp</span><span class="o">=</span><span class="s1">&#39;CO_posinp.xyz&#39;</span><span class="p">,</span><span class="n">d0</span><span class="o">=</span><span class="n">dipole_GS</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span><span class="n">F</span><span class="o">=</span><span class="n">intensity</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idir</span><span class="p">,</span><span class="n">coord</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]):</span>
    <span class="n">el</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">el</span><span class="p">[</span><span class="n">idir</span><span class="p">]</span><span class="o">=</span><span class="n">intensity</span>
    <span class="n">inp</span><span class="o">.</span><span class="n">apply_electric_field</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">ef</span><span class="o">.</span><span class="n">append_run</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">coord</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">:</span><span class="n">intensity</span><span class="p">},</span><span class="n">code</span><span class="p">,</span><span class="nb">input</span><span class="o">=</span><span class="n">inp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="n">ef</span><span class="o">.</span><span class="n">ids</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;id&#39;: &#39;x&#39;, &#39;F&#39;: 0.01}, {&#39;id&#39;: &#39;y&#39;, &#39;F&#39;: 0.01}, {&#39;id&#39;: &#39;z&#39;, &#39;F&#39;: 0.01}]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">extract_alpha</span><span class="p">(</span><span class="n">ef</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    alpha_ij isthe i-th component of the vector d-d0, computed with a field in the j-th direction,</span>
<span class="sd">    divided for the intensity of the field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ef</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;d0&#39;</span><span class="p">))</span>
    <span class="n">F</span><span class="o">=</span><span class="n">ef</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
    <span class="n">d</span><span class="o">=</span><span class="n">ef</span><span class="o">.</span><span class="n">fetch_results</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s1">&#39;dipole&#39;</span><span class="p">)</span>
    <span class="n">alpha</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idir</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">alpha</span><span class="p">[</span><span class="n">idir</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">idir</span><span class="p">])</span><span class="o">-</span><span class="n">d0</span><span class="p">)</span><span class="o">/</span><span class="n">F</span>
    <span class="k">return</span> <span class="n">alpha</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">ef</span><span class="o">.</span><span class="n">set_postprocessing_function</span><span class="p">(</span><span class="n">extract_alpha</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">alpha</span> <span class="o">=</span> <span class="n">ef</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">alpha</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_alpha&#39;
Creating the yaml input file &#34;CO_alpha/F:0.01,id:x.yaml&#34;
Run directory CO_alpha
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n F:0.01,id:x -s Yes
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_alpha&#39;
Creating the yaml input file &#34;CO_alpha/F:0.01,id:y.yaml&#34;
Run directory CO_alpha
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n F:0.01,id:y -s Yes
Copy the posinp file &#39;CO_posinp.xyz&#39; into &#39;CO_alpha&#39;
Creating the yaml input file &#34;CO_alpha/F:0.01,id:z.yaml&#34;
Run directory CO_alpha
Executing command:  mpirun -np 4 /home/marco/Applications/BigDFT/binaries/v1.8.3/install/bin/bigdft -n F:0.01,id:z -s Yes
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>matrix([[ 1.32354445e+01, -6.61113110e-04,  3.81100000e-02],
        [-6.61113110e-04,  1.32354445e+01,  3.81100000e-02],
        [-1.32899430e-04, -1.32899430e-04,  1.87275470e+01]])
</pre></div>
</div>
</div>
<p>A list of posinp for several molecules can be found as follows</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">BigDFT.Database</span> <span class="kn">import</span> <span class="n">Molecules</span>
<span class="n">CO</span><span class="o">=</span><span class="n">Molecules</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="s1">&#39;CO&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">CO</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Warning, line not parsed: &#34; C 0.0000 0.0000 0.0000
 &#39;NoneType&#39; object has no attribute &#39;__getitem__&#39; &#34;
Warning, line not parsed: &#34; O 0.0000 0.0000 1.1282 &#39;NoneType&#39; object has no attribute &#39;__getitem__&#39; &#34;
{&#39;units&#39;: &#39;angstroem&#39;, &#39;positions&#39;: [], &#39;global monopole&#39;: 0.0}
</pre></div></div>
</div>
<p>so this analysis can be easily performed for other cases.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
            
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">mppi 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2019, Marco D'Alessandro. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>